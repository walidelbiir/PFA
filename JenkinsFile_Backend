pipeline{
    agent any
    tools{nodejs "NodeJS 18.14.2"}
    stages{

        stage('Git Checkout') {
            steps {    
                git branch: 'main', credentialsId:'Github_Walid_Credentials', url: 'https://github.com/walidelbiir/PFA_BackEnd_App.git'
            }
        }
        stage("Installing Dependencies"){
            steps{
                sh 'npm i'
            }
        }
        stage("Installing Tests Dependencies"){
            steps {
                sh 'npm i --save-dev chai chai-http mocha sinon'
                sh 'npm i --save-dev mongodb-memory-server --ignore-scripts'
            }
        }
        stage("Testing") {
            steps {
                sh 'NODE_ENV=test npm test ./tests'
            }
        }
        
    }
}