@Library('PFA_Library') _

pipeline{
    agent any
    tools{nodejs "NodeJS 18.14.2"}
    stages{

        stage('Git Checkout') {
            steps {    
                script {
                    github.checkout(credentials: 'Github_Walid_Credentials' , githubURL: "https://github.com/walidelbiir/PFA_BackEnd_App.git")
                }
            }
        }
        stage("Installing Dependencies"){
            steps{
                script {
                    npm.install_dependencies()
                }
            }
        }
        stage("Installing Tests Dependencies"){
            steps {
                script {
                    npm.install_backend_test_dependencies()
                }
            }
        }
        stage("Testing") {
            steps {
                script{
                    npm.backend_test()
                }
            }
        }
        // stage("SonarQube Analysis") {
        //     steps {
        //         script {
        //             sonar.executeAnalysis('sonarqube_scanner' , 'sonraqube_server' , './sonar-project.properties')
        //         }
        //     }

        //     post {
        //         success {
        //             script {
        //                 sonar.qualityGateAnalysis()
        //             }
        //         }
        //     }
        // }
        
    }
}